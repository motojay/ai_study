<script>
const code = new URLSearchParams(window.location.search).get('code');
if (code) {
  // 替换为你的实际 PAT（临时方案，长期建议用后端代理）
  const DEPLOY_TOKEN = "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"; 

  fetch('https://api.github.com/repos/motojay/ai_study/dispatches', {
    method: 'POST',
    headers: {
      'Authorization': `token ${DEPLOY_TOKEN}`,
      'Accept': 'application/vnd.github.everest-preview+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ 
      event_type: 'feishu_oauth', 
      client_payload: { code } 
    })
  }).then(response => {
    if (!response.ok) throw new Error('API 返回错误状态');
    alert('授权成功！Token 将在后台处理。');
    window.location.href = 'https://飞书应用主页'; // 跳转到飞书
  }).catch(err => {
    console.error('授权失败:', err);
    alert('授权失败: ' + err.message);
  });
}
</script>
